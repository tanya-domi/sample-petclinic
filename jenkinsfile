pipeline {
    agent any
      tools {
        jfrog 'jfrog-cli'
      }
    stages {
        // stage('snyk scan') {
        //     steps {
        //         snykSecurity(
        //             snykInstallation: 'snyk@latest',
        //             snykTokenId: 'snyk_api_token',
        //             monitorProjectOnBuild: false,
        //             failOnIssues: false,  // Use boolean for failOnIssues
        //             additionalArguments: '--json-file-output=all-vulnerabilities.json'
        //         )
        //     }
        // }
        tools {
           maven "Maven-3.9.8"
    }
        stage ('Build jar') {
            steps {
                script {
                    echo 'Building jar'
                    sh 'mvn clean package -DskipTests=true'
                }
            }  
        }

        stage('building docker image') {
            steps {
                sh "docker build -t dts81/petclinic:${BUILD_NUMBER} ."
            }
        }
        stage('docker image push') {
            steps {
                withDockerRegistry(credentialsId: 'dockercred', url: '') {
                    sh "docker push dts81/petclinic:${BUILD_NUMBER}"
                }
            }
        }
        stage('Publish build info') {
            steps {
                jf 'rt build-publish'
            }
        }
        stage('push artifact') {
            steps {
              jf 'rt u /var/lib/jenkins/workspace/pipeline_part3/target/spring-petclinic-3.4.0-SNAPSHOT.jar  petclinic_artifact-libs-snapshot-local/springpetclinic/spring-petclinic-3.4.0-SNAPSHOT.jar'
            }
        }

    }
}